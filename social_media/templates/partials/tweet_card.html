<!-- Template partiel pour l'affichage d'un tweet -->
{% load social_tags %}

<article class="border-b border-x-border p-4 hover:bg-x-darker/50 transition-colors">
    <!-- Indication de retweet -->
    {% if tweet.is_retweet %}
    <div class="flex items-center space-x-2 mb-2 ml-12 text-x-gray text-sm">
        <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 24 24">
            <path d="M23.77 15.67c-.292-.293-.767-.293-1.06 0l-2.22 2.22V7.65c0-2.068-1.683-3.75-3.75-3.75h-5.85c-.414 0-.75.336-.75.75s.336.75.75.75h5.85c1.24 0 2.25 1.01 2.25 2.25v10.24l-2.22-2.22c-.293-.293-.768-.293-1.061 0s-.293.768 0 1.061l3.5 3.5c.145.147.337.22.53.22s.383-.072.53-.22l3.5-3.5c.294-.292.294-.767.001-1.06z"/>
        </svg>
        <span>{{ tweet.author.user.username }} a retweeté</span>
    </div>
    {% endif %}
    
    <div class="flex space-x-3">
        {% user_avatar tweet.original_tweet.author size='medium' %}
        <div class="flex-1">
            <div class="flex items-center justify-between mb-1">
                <div class="flex items-center space-x-2">
                    <a href="{% url 'public_profile' username=tweet.original_tweet.author.user.username %}" class="font-bold hover:underline text-x-text">
                        {{ tweet.original_tweet.author.user|user_display_name }}
                    </a>
                    <a href="{% url 'public_profile' username=tweet.original_tweet.author.user.username %}" class="text-x-gray hover:underline">@{{ tweet.original_tweet.author.user.username }}</a>
                    <span class="text-x-gray">·</span>
                    <span class="text-x-gray">{{ tweet.original_tweet.created_at|timesince }}</span>
                </div>
                
                <!-- Menu trois points (seulement pour l'auteur) -->
                {% if user.is_authenticated and tweet.original_tweet.author == user.profile %}
                <div class="relative">
                    <button class="tweet-menu-btn p-2 text-x-gray hover:text-x-text hover:bg-x-darker rounded-full transition-colors" 
                            data-tweet-id="{{ tweet.original_tweet.id }}"
                            title="Options">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                        </svg>
                    </button>
                    
                    <!-- Menu déroulant -->
                    <div class="tweet-menu absolute right-0 top-full mt-1 bg-x-darker border border-x-border rounded-lg shadow-xl py-1 min-w-[120px] hidden" 
                         style="z-index: 50;">
                        <button class="delete-tweet-btn w-full text-left px-4 py-2 text-red-400 hover:bg-red-500/10 transition-colors text-sm" 
                                data-tweet-id="{{ tweet.original_tweet.id }}">
                            Supprimer
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <!-- Contenu du tweet avec hashtags et mentions cliquables -->
            <p class="mb-3 text-x-text leading-relaxed">
                {{ tweet.original_tweet.content|hashtag_links|mention_links|linebreaks }}
            </p>
            
            <!-- Image du tweet -->
            {% if tweet.original_tweet.image %}
            <div class="mb-3 rounded-2xl overflow-hidden border border-x-border">
                <img src="{{ tweet.original_tweet.image.url }}" class="w-full max-h-96 object-cover hover:opacity-95 transition-opacity" alt="Image du tweet">
            </div>
            {% endif %}
            
            <!-- Actions du tweet -->
            {% tweet_actions tweet.original_tweet %}
        </div>
    </div>
</article>
